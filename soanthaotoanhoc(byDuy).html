<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tr√¨nh So·∫°n Th·∫£o H√¨nh H·ªçc To√†n Di·ªán</title>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']], processEscapes: true},
        showProcessingMessages: false, messageStyle: "none"
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    
    <style>
        :root { --blue: #2980b9; --green: #27ae60; --dark: #2c3e50; --orange: #f39c12; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: #f0f2f5; }
        header { background: var(--dark); color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
        
        /* Toolbar Styles */
        .toolbar { background: #fff; padding: 8px; border-bottom: 1px solid #ccc; display: flex; gap: 5px; flex-wrap: wrap; align-items: center; }
        .group { display: flex; gap: 3px; padding-right: 8px; border-right: 1px solid #ddd; margin-right: 5px; }
        button { padding: 6px 10px; cursor: pointer; border: 1px solid #ddd; background: #fff; border-radius: 4px; font-size: 13px; transition: 0.2s; }
        button:hover { background: #f1f2f6; border-color: var(--blue); }
        select { padding: 5px; border-radius: 4px; border: 1px solid #ddd; cursor: pointer; }

        /* Main Layout */
        .main { display: flex; flex: 1; overflow: hidden; padding: 10px; gap: 10px; }
        .pane { display: flex; flex-direction: column; flex: 1; background: white; border-radius: 4px; border: 1px solid #ddd; }
        .label { background: #f8f9fa; padding: 5px 10px; font-size: 11px; font-weight: bold; color: #666; border-bottom: 1px solid #eee; }
        textarea { flex: 1; padding: 15px; font-size: 15px; border: none; resize: none; font-family: 'Consolas', monospace; outline: none; line-height: 1.5; }
        #preview { flex: 1; padding: 30px; overflow-y: auto; font-size: 18px; line-height: 1.7; font-family: 'Times New Roman', serif; }

        /* Print Style */
        .btn-print { background: var(--green); color: white; border: none; font-weight: bold; padding: 8px 20px; }
        @media print {
            header, .toolbar, .label, textarea { display: none !important; }
            .main { display: block; padding: 0; }
            .pane { border: none; }
            #preview { padding: 0; overflow: visible; width: 100%; }
        }
    </style>
</head>
<body>

<header>
    <div style="font-weight: bold;">C√îNG C·ª§ SO·∫†N TH·∫¢O TO√ÅN H·ªåC T·ªîNG H·ª¢P</div>
    <button class="btn-print" onclick="window.print()">üñ®Ô∏è XU·∫§T FILE PDF / IN</button>
</header>

<div class="toolbar">
    <div class="group">
        <select onchange="insertHeading(this.value); this.value='';">
            <option value="">Ti√™u ƒë·ªÅ...</option>
            <option value="H1">Ti√™u ƒë·ªÅ 1</option>
            <option value="H2">Ti√™u ƒë·ªÅ 2</option>
            <option value="H3">Ti√™u ƒë·ªÅ 3</option>
        </select>
        <button onclick="wrapText('**', '**')" title="Ch·ªØ ƒë·∫≠m"><b>B</b></button>
        <button onclick="wrapText('*', '*')" title="Ch·ªØ nghi√™ng"><i>I</i></button>
    </div>

    <div class="group">
        <button onclick="insertAtStart('* ')">‚Ä¢ Danh s√°ch</button>
        <button onclick="insertAtStart('1. ')">1. S·ªë th·ª© t·ª±</button>
    </div>

    <div class="group">
        <button onclick="add('\\triangle ')">Œî</button>
        <button onclick="add('\\widehat{...}')">\( \widehat{A} \)</button>
        <button onclick="add('^\\circ')">\( ^\circ \)</button>
        <button onclick="add('\\perp ')">‚ä•</button>
        <button onclick="add('\\parallel ')">‚à•</button>
        <button onclick="add('\\in ')">‚àà</button>
        <button onclick="add('\\Rightarrow ')">‚áí</button>
    </div>

    <button style="background: var(--orange); color: white;" onclick="cleanEmptyLines()">üßπ Xo√° d√≤ng tr·ªëng</button>
    <button onclick="update()">üîÑ L√†m m·ªõi</button>
</div>

<div class="main">
    <div class="pane">
        <div class="label">N·ªòI DUNG M√É</div>
        <textarea id="editor" oninput="update()" placeholder="Nh·∫≠p n·ªôi dung... D√πng **ƒë·∫≠m** v√† *nghi√™ng*"></textarea>
    </div>
    <div class="pane">
        <div class="label">HI·ªÇN TH·ªä TR·ª∞C QUAN</div>
        <div id="preview"></div>
    </div>
</div>

<script>
    const editor = document.getElementById('editor');
    const preview = document.getElementById('preview');

    function update() {
        let content = editor.value;

        // 1. X·ª≠ l√Ω Ti√™u ƒë·ªÅ (Markdown style)
        content = content.replace(/^# (.*$)/gim, '<h1>$1</h1>');
        content = content.replace(/^## (.*$)/gim, '<h2>$1</h2>');
        content = content.replace(/^### (.*$)/gim, '<h3>$1</h3>');

        // 2. X·ª≠ l√Ω Ch·ªØ ƒë·∫≠m/nghi√™ng
        content = content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        content = content.replace(/\*(.*?)\*/g, '<em>$1</em>');

        // 3. X·ª≠ l√Ω Danh s√°ch
        content = content.replace(/^\* (.*$)/gim, '<ul><li>$1</li></ul>');
        content = content.replace(/^\d+\. (.*$)/gim, '<ol><li>$1</li></ol>');
        // G·ªôp c√°c th·∫ª ul/ol li·ªÅn nhau
        content = content.replace(/<\/ul>\s*<ul>/g, '').replace(/<\/ol>\s*<ol>/g, '');

        // 4. Xu·ªëng d√≤ng
        content = content.replace(/\n/g, '<br>');

        preview.innerHTML = content;
        
        if (window.MathJax) {
            MathJax.Hub.Queue(["Typeset", MathJax.Hub, preview]);
        }
    }

    function insertHeading(type) {
        const h = type === 'H1' ? '# ' : type === 'H2' ? '## ' : '### ';
        insertAtStart(h);
    }

    function wrapText(before, after) {
        const start = editor.selectionStart;
        const end = editor.selectionEnd;
        const selected = editor.value.substring(start, end);
        const text = editor.value;
        editor.value = text.substring(0, start) + before + selected + after + text.substring(end);
        update();
    }

    function insertAtStart(mark) {
        const start = editor.selectionStart;
        const text = editor.value;
        editor.value = text.substring(0, start) + mark + text.substring(start);
        update();
        editor.focus();
    }

    function add(val) {
        const start = editor.selectionStart;
        const end = editor.selectionEnd;
        const insert = `$${val}$`;
        editor.value = editor.value.substring(0, start) + insert + editor.value.substring(end);
        if(val.includes('...')) {
            editor.selectionStart = start + insert.indexOf('...');
            editor.selectionEnd = editor.selectionStart + 3;
        }
        update();
        editor.focus();
    }

    function cleanEmptyLines() {
        editor.value = editor.value.split('\n').filter(line => line.trim() !== '').join('\n');
        update();
    }

    // T·ª± ƒë·ªông l∆∞u v√† t·∫£i l·∫°i
    editor.value = localStorage.getItem('geoDoc') || "";
    editor.onkeyup = () => localStorage.setItem('geoDoc', editor.value);
    window.onload = update;
</script>

</body>
</html>