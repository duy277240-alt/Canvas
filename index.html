<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="google-site-verification" content="99ELBLT9ezF436vgq51ZOxRiSGnZk5aUIGfHFO5Erx4" />
    <title>Canvas H√¨nh H·ªçc Pro - Full Features</title>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']], processEscapes: true},
        showProcessingMessages: false, messageStyle: "none"
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    
    <style>
        :root { --blue: #2980b9; --green: #27ae60; --dark: #2c3e50; --orange: #f39c12; --red: #e74c3c; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: #eaeff2; }
        header { background: var(--dark); color: white; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        
        /* Toolbar */
        .toolbar { background: #fff; padding: 10px; border-bottom: 1px solid #ccc; display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
        .group { display: flex; gap: 3px; padding-right: 8px; border-right: 1px solid #ddd; margin-right: 5px; }
        
        /* Layout ch√≠nh */
        .main { display: flex; flex: 1; overflow: hidden; padding: 10px; gap: 10px; }
        .pane { display: flex; flex-direction: column; flex: 1; background: white; border-radius: 8px; overflow: hidden; border: 1px solid #dcdde1; }
        .label { background: #f5f6fa; padding: 8px 15px; font-size: 11px; font-weight: bold; color: #7f8c8d; border-bottom: 1px solid #eee; }
        
        textarea { flex: 1; padding: 20px; font-size: 16px; border: none; resize: none; font-family: 'Consolas', monospace; outline: none; line-height: 1.6; }
        #preview { flex: 1; padding: 40px; overflow-y: auto; font-size: 18px; line-height: 1.8; font-family: 'Times New Roman', serif; }
        
        /* Sidebar Ph·∫£n h·ªìi */
        .feedback-section { width: 350px; background: white; border-radius: 8px; border: 1px solid #dcdde1; display: flex; flex-direction: column; padding: 15px; overflow-y: auto; }

        /* Buttons */
        button { padding: 8px 12px; cursor: pointer; border: 1px solid #dcdde1; background: white; border-radius: 5px; font-weight: 500; transition: 0.2s; }
        button:hover { background: #f1f2f6; border-color: var(--blue); color: var(--blue); }
        select { padding: 7px; border-radius: 5px; border: 1px solid #ddd; }
        .btn-print { background: var(--green); color: white; border: none; padding: 10px 25px; font-size: 14px; }
        .btn-clean { background: var(--orange); color: white; border: none; }
        .btn-clean:hover { background: #e67e22; color: white; }

        /* Print Settings */
        @media print {
            header, .toolbar, .feedback-section, .label, textarea { display: none !important; }
            .main { display: block; padding: 0; }
            .pane { border: none; }
            #preview { border: none; padding: 0; width: 100%; overflow: visible; }
        }
    </style>
</head>
<body>

<header>
    <div style="font-size: 1.2rem; font-weight: bold;">C√îNG C·ª§ SO·∫†N TH·∫¢O TO√ÅN H√åNH H·ªåC</div>
    <button class="btn-print" onclick="printDocument()">üñ®Ô∏è XU·∫§T FILE PDF / IN B√ÄI</button>
</header>

<div class="toolbar">
    <div class="group">
        <select onchange="insertHeading(this.value); this.value='';">
            <option value="">Ti√™u ƒë·ªÅ...</option>
            <option value="H1">Ti√™u ƒë·ªÅ 1</option>
            <option value="H2">Ti√™u ƒë·ªÅ 2</option>
            <option value="H3">Ti√™u ƒë·ªÅ 3</option>
        </select>
        <button onclick="wrapText('**', '**')"><b>B</b></button>
        <button onclick="wrapText('*', '*')" style="font-style: italic;">I</button>
    </div>

    <div class="group">
        <button onclick="add('\\triangle ')">Œî Tam gi√°c</button>
        <button onclick="add('\\widehat{...}')">\( \widehat{A} \)</button>
        <button onclick="add('^\\circ')">\( ^\circ \)</button>
        <button onclick="add('\\perp ')">‚ä•</button>
        <button onclick="add('\\parallel ')">‚à•</button>
        <button onclick="add('\\in ')">‚àà</button>
        <button onclick="add('\\Rightarrow ')">‚áí</button>
    </div>

    <button class="btn-clean" onclick="cleanEmptyLines()">üßπ D·ªçn d√≤ng tr·ªëng</button>
    <button onclick="update()">‚ö° Render L·∫°i</button>
    <button onclick="localStorage.clear(); location.reload();" style="color: var(--red);">X√≥a h·∫øt</button>
</div>

<div class="main">
    <div class="pane">
        <div class="label">M√É SO·∫†N TH·∫¢O (H·ªó tr·ª£ Markdown & LaTeX)</div>
        <textarea id="editor" placeholder="Nh·∫≠p n·ªôi dung b√†i to√°n t·∫°i ƒë√¢y..." oninput="update()"></textarea>
    </div>
    
    <div class="pane">
        <div class="label">B·∫¢N IN XEM TR∆Ø·ªöC</div>
        <div id="preview"></div>
    </div>

    <div class="feedback-section">
        <div style="font-weight: bold; color: var(--dark); border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;">
            B√åNH LU·∫¨N & G√ìP √ù
        </div>
        
        <script src="https://utteranc.es/client.js"
            repo="duy277240-alt/Canvas"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
        </script>
    </div>
</div>

<iframe id="printFrame" style="display:none;"></iframe>

<script>
    const editor = document.getElementById('editor');
    const preview = document.getElementById('preview');

    // T·ª± ƒë·ªông t·∫£i d·ªØ li·ªáu c≈©
    if(localStorage.getItem('savedMathDoc')) {
        editor.value = localStorage.getItem('savedMathDoc');
    }

    function update() {
        localStorage.setItem('savedMathDoc', editor.value);
        let content = editor.value;

        // X·ª≠ l√Ω Markdown ƒë∆°n gi·∫£n
        content = content.replace(/^# (.*$)/gim, '<h1>$1</h1>');
        content = content.replace(/^## (.*$)/gim, '<h2>$1</h2>');
        content = content.replace(/^### (.*$)/gim, '<h3>$1</h3>');
        content = content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        content = content.replace(/\*(.*?)\*/g, '<em>$1</em>');
        
        // Xu·ªëng d√≤ng
        content = content.replace(/\n/g, '<br>');
        
        preview.innerHTML = content;
        
        if (window.MathJax) {
            MathJax.Hub.Queue(["Typeset", MathJax.Hub, preview]);
        }
    }

    function insertHeading(type) {
        const h = type === 'H1' ? '# ' : type === 'H2' ? '## ' : '### ';
        const start = editor.selectionStart;
        editor.value = editor.value.substring(0, start) + h + editor.value.substring(start);
        update();
        editor.focus();
    }

    function wrapText(before, after) {
        const s = editor.selectionStart, e = editor.selectionEnd;
        const sel = editor.value.substring(s, e);
        editor.value = editor.value.substring(0, s) + before + sel + after + editor.value.substring(e);
        update();
        editor.focus();
    }

    function add(val) {
        const start = editor.selectionStart;
        const insert = `$${val}$`;
        editor.value = editor.value.substring(0, start) + insert + editor.value.substring(editor.selectionEnd);
        if(val.includes('...')) {
            editor.selectionStart = start + insert.indexOf('...');
            editor.selectionEnd = editor.selectionStart + 3;
        }
        update();
        editor.focus();
    }

    function cleanEmptyLines() {
        editor.value = editor.value.split('\n').filter(line => line.trim() !== '').join('\n');
        update();
    }

    function printDocument() {
        const printFrame = document.getElementById('printFrame');
        const doc = printFrame.contentWindow.document;
        doc.open();
        doc.write(`
            <html>
                <head>
                    <title>B·∫£n in t√†i li·ªáu</title>
                    <style>
                        body { font-family: 'Times New Roman', serif; padding: 40px; line-height: 1.6; font-size: 14pt; }
                        h1 { font-size: 24pt; } h2 { font-size: 20pt; } h3 { font-size: 16pt; }
                        .mjx-chtml { font-size: 115% !important; }
                    </style>
                </head>
                <body>${preview.innerHTML}</body>
            </html>
        `);
        doc.close();
        setTimeout(() => {
            printFrame.contentWindow.focus();
            printFrame.contentWindow.print();
        }, 600);
    }

    window.onload = update;
</script>

</body>
</html>
